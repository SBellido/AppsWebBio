<section class="container">
    <app-header-encode></app-header-encode>
    <section class="main-app-section">

        <div class="selectionComponent">

            <div *ngIf="started == true; then selectionStarted else selectionStopped">
                <!-- template will replace this div -->
            </div>

            <!-- selectionStopped -->
            <ng-template #selectionStopped>
                <h1 class="title" *ngIf="completed == false">Tarea de Selección</h1>
                <p *ngIf="completed == false">Ahora te voy a pedir que selecciones de entre 12 pares de fotos la que corresponde con las imágenes que viste en el video.</p>
                <h1 class="title" *ngIf="completed == true">¡Ya seleccionaste las imagenes! Por favor, continua al siguiente paso.</h1>
                <div class="stepper-buttons" *ngIf="completed == true">
                    <h4>Seleccionadas {{currentStep}}/{{steps}}</h4>
                </div>
                <button mat-raised-button 
                    id="continue-button" 
                    color="primary" 
                    aria-label="continuar"
                    (click)="continue()">
                    Continuar
                </button>
            </ng-template>

            <!-- selectionStarted -->
            <ng-template #selectionStarted>
                <h1 class="title">Seleccioná la foto que corresponde con lo que viste en el video.</h1>

                <div *ngIf="imagesPairsLoaded == true; then selectionTemplate else loading">
                    <!-- template will replace this div -->
                </div>
        
                <!-- loading -->
                <ng-template #loading>
                    <p>Cargando...</p>
                </ng-template>

                <ng-template #selectionTemplate>
                    <mat-card>
                    
                        <mat-card-content class="card-content">
                            
                            <mat-stepper linear #stepper>
                                <mat-step *ngFor="let random of random_pairs; let index = index" [optional]="true">
                                    
                                    <form>

                                        <div *ngIf="random == 0; then first else second">
                                            <!-- template will replace this div -->
                                        </div>

                                        <ng-template #first>
                                            <mat-button-toggle-group>
                                                <mat-button-toggle (click)="onSelection(imagesPairs[index*2])">
                                                    <img class="selection-image" src={{imagesPairs[index*2].imageURL}}/>
                                                </mat-button-toggle>
                                                <mat-button-toggle (click)="onSelection(imagesPairs[(index*2)+1])">
                                                    <img class="selection-image" src={{imagesPairs[(index*2)+1].imageURL}}/>
                                                </mat-button-toggle>
                                            </mat-button-toggle-group>
                                        </ng-template>

                                        <ng-template #second>
                                            <mat-button-toggle-group>
                                                <mat-button-toggle (click)="onSelection(imagesPairs[(index*2)+1])">
                                                    <img class="selection-image" src={{imagesPairs[(index*2)+1].imageURL}}/>
                                                </mat-button-toggle>
                                                <mat-button-toggle (click)="onSelection(imagesPairs[index*2])">
                                                    <img class="selection-image" src={{imagesPairs[index*2].imageURL}}/>
                                                </mat-button-toggle>
                                            </mat-button-toggle-group>
                                        </ng-template>

                                        <div class="stepper-buttons">
                                            <button [disabled]="!selectionMade" (click)="onConfirm()" mat-button matStepperNext>SIGUIENTE</button>
                                        </div>
                                        <div class="stepper-buttons">
                                            <h4>Seleccionadas {{currentStep}}/{{steps}}</h4>
                                        </div>
                                    </form>
                                    
                                </mat-step>
                            </mat-stepper>
        
                        </mat-card-content>
        
                    </mat-card>
                </ng-template>

            </ng-template>
            
        </div>
                
    </section>
    
</section>
